<nav class="onglets">

    <a *ngIf="roleConnecte !== 'SECRETAIRE'" (click)="ongletActif = 'utilisateur'"
        [ngClass]="{ 'active': ongletActif === 'utilisateur' }" class="nav-link">
        <i class="icon">üë§</i> Utilisateur</a>

    <a (click)="ongletActif = 'config'" [ngClass]="{ 'active': ongletActif === 'config' }"
        class="nav-link">Configuration</a>

    <a (click)="ongletActif = 'importation'" [ngClass]="{ 'active': ongletActif === 'scolarite' }"
        class="nav-link">Importation</a>

</nav>




<div class="container" *ngIf="ongletActif === 'utilisateur' && roleConnecte !== 'SECRETAIRE'">
    <div class="left-box">
        <h4>{{ isEditMode ? 'Modifier un utilisateur' : 'Ajouter un utilisateur' }}</h4>
        <form #formUser="ngForm" (ngSubmit)="isEditMode ? modifierUtilisateur() : ajouterUtilisateur()">
            <div class="form-group">
                <label for="roleUser">R√¥le :</label>
                <select id="roleUser" [(ngModel)]="credentials.role" name="role" required>
                    <option value="" disabled selected>S√©lectionnez un r√¥le</option>
                    <option *ngFor="let r of roles" [value]="r">{{ r | titlecase }}</option>
                </select>
            </div>

            <div class="form-group">
                <label for="emailUser">Nom :</label>
                <input type="text" id="emailUser" [(ngModel)]="credentials.email" name="email" required>
            </div>

            <div class="form-group">
                <label for="passwordUser">Mot de passe :</label>
                <input [type]="passwordVisible ? 'text' : 'password'" id="passwordUser"
                    [(ngModel)]="credentials.password" name="password" required autocomplete="off">
            </div>

            <div class="form-group">
                <label for="confirmPasswordUser">Confirmer le mot de passe :</label>
                <input [type]="passwordVisible ? 'text' : 'password'" id="confirmPasswordUser"
                    [(ngModel)]="credentials.confirmPassword" name="confirmPassword" required autocomplete="off">
            </div>



            <button type="submit" class="submit-btn"
                [disabled]="!formUser.valid || credentials.password !== credentials.confirmPassword">
                {{ isEditMode ? 'Mettre √† jour' : 'S\'inscrire' }}
            </button>

            <div *ngIf="credentials.password && credentials.confirmPassword && credentials.password !== credentials.confirmPassword"
                style="color: red;">
                Les mots de passe ne correspondent pas.
            </div>
        </form>
    </div>

    <div class="right-box">
        <h4>Gestion des Utilisateurs</h4>
        <table *ngIf="utilisateurs.length > 0">
            <thead>
                <tr>
                    <th>Id</th>
                    <th>R√¥le</th>
                    <th>Nom</th>
                    <th>Mdp</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let u of utilisateurs; let i = index">
                    <td>{{ i + 1 }}</td>
                    <td>{{ u.role }}</td>
                    <td>{{ u.email }}</td>
                    <td>{{ u.password }}</td>

                    <td>
                        <button class="btn btn-sm btn-warning me-2" (click)="remplirFormulairePourModification(u, i)">
                            <i class="fas fa-edit"></i>
                        </button>
                        <br>
                        <button class="btn btn-sm btn-danger" (click)="supprimerUtilisateur(i)">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </td>


                </tr>
            </tbody>
        </table>
        <p *ngIf="utilisateurs.length === 0">Aucun utilisateur trouv√©.</p>
    </div>
</div>

<div class="container" *ngIf="ongletActif === 'config'">
    <div class="left-box">
        <form (ngSubmit)="onSubmit()">
            <div class="form-group">
                <label>Nom de l'entreprise</label>
                <input type="text" [(ngModel)]="organisation.nom" name="nom" />
            </div>

            <div class="form-group">
                <label>Logo</label>
                <input type="file" accept="image/*" (change)="onLogoSelected($event)" />
            </div>

            <!-- Aper√ßu de l‚Äôimage choisie -->
            <div *ngIf="organisation.logoUrl" class="preview-logo">
                <img [src]="organisation.logoUrl" alt="Logo organisation" />
            </div>


            <div class="form-row">

                <div class="form-group">
                    <label>Adresse</label>
                    <input type="text" [(ngModel)]="organisation.ville" name="ville" />
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>T√©l√©phone1</label>
                    <input type="text" [(ngModel)]="organisation.telephone" name="telephone" />
                </div>
                <div class="form-group">
                    <label>T√©l√©phone2</label>
                    <input type="text" [(ngModel)]="organisation.telephone" name="telephone" />
                </div>
            </div>

            <button class="submit-btn" type="submit">Sauvegarder</button>
        </form>
    </div>

    <div class="right-box">
        <h4>Aper√ßu de l'organisation</h4>
        <div class="preview-box" *ngIf="organisation.nom || organisation.email">
            <p><strong>Nom :</strong> {{ organisation.nom }}</p>
            <p><strong>Adresse :</strong> {{ organisation.adresse }} - {{ organisation.ville }}</p>
            <p><strong>T√©l√©phone :</strong> {{ organisation.telephone }}</p>
            <p><strong>Email :</strong> {{ organisation.email }}</p>
            <p><strong>Logo :</strong></p>
            <img *ngIf="organisation.logoUrl" [src]="organisation.logoUrl" alt="Logo organisation"
                style="max-height:80px;">
        </div>
        <p *ngIf="!organisation.nom && !organisation.email">Aucune information enregistr√©e.</p>
    </div>
</div>


<div class="container" *ngIf="ongletActif === 'importation' ">

    <div class="section">
        <h3 class="section-title">Importer des produits</h3>
        <p class="section-desc">
            Ajoutez ou mettez √† jour des produits en masse √† partir d'un fichier Excel (.xlsx, .csv).
        </p>

        <label class="btn-upload">
            üìÇ Importer un fichier
            <input type="file" hidden accept=".xlsx,.csv" />
        </label>
    </div>
</div>